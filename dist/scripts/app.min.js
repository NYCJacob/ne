var app=app||{};!function(){"use strict";function e(){app.service=new google.maps.places.PlacesService(app.map),app.service.nearbySearch({location:app.neighborhood,radius:500,type:["restaurant"]},t)}function t(e,t){t===google.maps.places.PlacesServiceStatus.OK?(app.RestaurantArray=e.map(function(t){var o=e.indexOf(t);return new r(t,o)}),app.RestaurantArray.forEach(n),app.RestaurantArray.forEach(o),app.vm=new s(app.RestaurantArray),ko.applyBindings(app.vm,document.getElementById("main-content"))):console.log("place service status error")}function o(e){function t(t,n){n===google.maps.places.PlacesServiceStatus.OK?e.addDetails(t):n===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?setTimeout(function(){o(e)},200):console.log("details error "+n)}var n=new google.maps.places.PlacesService(app.map),a={placeId:e.placeId};n.getDetails(a,t)}function n(e){var t={url:e.mapIcon,size:new google.maps.Size(35,35),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,34),scaledSize:new google.maps.Size(25,25)};e.mapMarker=new google.maps.Marker({map:app.map,icon:t,title:e.name,animation:google.maps.Animation.DROP,position:e.geometry.location,id:e.id}),google.maps.event.addListener(e.mapMarker,"click",function(){app.vm.octoHighlighter(e)})}function a(e){var t=e.address_formatted,o=t.slice(0,-5),n=function(){return e.hours.open_now===!0?"YES":e.hours.open_now===!1?"NO":"unknown"},a=function(){for(var t="<ul>",o=0;o<e.hours.weekday_text.length;o++)t+="<li>"+e.hours.weekday_text[o]+"</li>";return t+="</ul>"},s=function(){switch(e.priceLevel){case 1:return"$";case 2:return"$$";case 3:return"$$$";case 4:return"$$$$";case 5:return"$$$$$";default:return"unknown"}},r='<div class="infoWindow"><span class="infoWindow-name">'+e.name+'</span><span class="infoWindow-address">'+o+'</span><span class="infoWindow-website">Website '+e.website+'</span><span class="infoWindow-priceLevel">Price Level: </span><span class="dollar-sign"><strong>'+s()+'</strong></span> | <span class="infoWindow-rating">Google Rating: </span><span><strong>'+e.rating+'</strong></span><span class="infoWindow-openNow">Open Now: '+n()+'</span><span class="infoWindow-hours"><strong>Hours: </strong></span><span class="infoWindow-open">'+a()+"</span>";return r}function s(e){var t=this;setTimeout(function(){"object"!=typeof google&&t.noInternet(!0)},3e3),t.noInternet=ko.observable(!1),t.restaurants=ko.observableArray(e),t.currentPlace=ko.observable(null),t.showSlides=ko.observable(!1),t.noPhotos=ko.observable(!1),t.showPhotos=ko.observable(!1),t.togglePhotos=function(){t.showPhotos()===!1?t.showPhotos(!0):t.showPhotos(!1)},t.placePhotos=ko.observableArray([]),t.photoUrlArray=function(){if(void 0!==t.placePhotos()){var e=[];return ko.utils.arrayForEach(t.placePhotos(),function(t){e.push(t.getUrl({maxHeight:50,maxWidth:50}))}),e}return t.noPhotos(!0),t.showPhotos(!1),[]},t.slideUrlArray=function(){if(t.noPhotos()===!1){var e=[],o=$("#details-sidebar").innerWidth(),n=$("#details-sidebar").innerHeight();return ko.utils.arrayForEach(t.placePhotos(),function(t){e.push(t.getUrl({maxHeight:Math.floor(.75*o),maxWidth:Math.floor(.25*n)}))}),e}return-1},t.slideIndex=1,t.slideShow=function(e){var o,n=document.getElementsByClassName("mySlides");for(e>n.length&&(t.slideIndex=1),e<1&&(t.slideIndex=n.length),o=0;o<n.length;o++)n[o].style.display="none";n[t.slideIndex-1].style.display="block"},t.nextSlide=function(e){t.slideShow(t.slideIndex+=e)},t.reviewHeadline=ko.observable(),t.showReviews=ko.observable(!1),t.inspectionHeadline=ko.observable(),t.photosHeadline=ko.observable(),t.showInspections=ko.observable(!1),t.inspectionRequestSuccess=ko.observable(!1),t.showYelp=ko.observable(!1),t.yelpHeadline=ko.observable(),t.yelpRequestSuccess=ko.observable(!1),t.searchTerm=ko.observable(""),t.filteredItems=ko.computed(function(){var e=t.searchTerm().toLowerCase();return e?ko.utils.arrayFilter(t.restaurants(),function(t){var o=t.name.toLowerCase().indexOf(e)!==-1;return t.mapMarker.setVisible(o),o}):(t.restaurants().forEach(function(e){e.mapMarker.setVisible(!0)}),t.restaurants())}),t.octoHighlighter=function(e){t.showPhotos(!1),t.noPhotos(!1),null!==t.currentPlace()&&(t.currentPlace().mapMarker.setIcon(t.currentPlace().mapIconNormal),t.reviewHeadline("")),e.mapMarker.setIcon(e.mapIconRed),app.infoWindow.setContent(a(e)),app.infoWindow.open(app.map,e.mapMarker),t.currentPlace(e),void 0!==t.currentPlace().photos&&t.placePhotos(t.currentPlace().photos),t.reviewTotal=function(){var e;return e=void 0===t.currentPlace().reviews||0===t.currentPlace().reviews?0:t.currentPlace().reviews.length},t.reviewHeadline(t.currentPlace().name+" has "+t.reviewTotal()+" reviews from Google."),t.getNYCinspections(t.currentPlace),void 0!==t.currentPlace().phone?t.getYelp(t.currentPlace):t.yelpHeadline(t.currentPlace().name+" has insufficient data to perform Yelp search."),t.showDetailsSidebar(),app.map.panTo(app.neighborhood)},t.closeNav=function(){app.detailsSidebar.style.width="0",app.detailsSidebar.style.visibility="hidden",app.mapDivEl.style.width="100%",app.listingEl.style.marginLeft="0",app.leftHamburger.style.transform="translate(-25vw, 0)",app.leftHamburger.style.transition="transform 0.3s ease",app.leftHamburger.style.display="none",app.infoWindow.close(),app.map.panTo(app.neighborhood)},t.showDetailsSidebar=function(){app.detailsSidebar.style.width="50%",app.detailsSidebar.style.visibility="visible",app.mapDivEl.style.width="50%",app.listingEl.style.marginLeft="-50%",app.leftHamburger.style.transform="translate(0, 0)"},t.toggleSlides=function(){t.showSlides()===!1?(t.showSlides(!0),t.slideShow(1)):t.showSlides(!1)},t.toggleReviews=function(){t.showReviews()===!1?t.showReviews(!0):t.showReviews(!1)},t.toggleInspections=function(){t.showInspections()===!1?(t.showInspections(!0),t.showReviews()===!0&&t.showReviews(!1)):t.showInspections(!1)},t.toggleYelp=function(){t.showYelp()===!1?t.showYelp(!0):t.showYelp(!1)},t.getNYCinspections=function(e){var o=e().name.toUpperCase();$.ajax({url:"https://data.cityofnewyork.us/resource/9w7m-hzhe.json",type:"GET",data:{zipcode:"11372",dba:o,$limit:50,$$app_token:"PCvLGVSSaI1KBWr0dwX7vhl1E",$select:"*"}}).done(function(e){$.trim(e)||(t.inspectionRequestSuccess=!1,t.inspectionHeadline("No NYC inspection data found."));var o=[];t.inspectionRequestSuccess=!0,e.forEach(function(e){e.hasOwnProperty("grade")&&(e.grade_date=new Date(e.grade_date),e.grade_date_display=e.grade_date.getMonth()+"-"+e.grade_date.getDate()+"-"+e.grade_date.getFullYear(),o.push(e))}),o.sort(function(e,t){return t.grade_date-e.grade_date}),t.currentPlace().inspectionResults(o),t.latestGrade=function(){return void 0===o||0===o.length?"unknown":o[0].grade},t.inspectionHeadline("Latest Grade: "+t.latestGrade())}).fail(function(){console.log("nycinspection ajax error"),t.inspectionRequestSuccess=!1,t.inspectionHeadline("Request failed, please try again later.")})},t.getYelp=function(e){function o(){return Math.floor(1e12*Math.random()).toString()}function n(e){return e.replace(/\D/g,"")}var a=function(){return void 0!==e().phone?n(e().phone):-1},s="gtnzS8XUXupQ7t3yEUM-zgJeNz8",r="5e8aVm47PCOnFIqWNsAO3A",i="e9CjCBMdlA3nunOhtdN9xHkNyc_Qa329",l="z9vc2A_2yoIUYqe34Z3hKZlddYI",p="GET",c="https://api.yelp.com/v2/phone_search?phone="+a(),u={phone:a(),oauth_consumer_key:r,oauth_token:i,oauth_nonce:o(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb"},d=oauthSignature.generate(p,c,u,s,l);u.oauth_signature=d;var h={url:c,data:u,cache:!0,dataType:"jsonp",success:function(o){t.yelpRequestSuccess(!0);var n;o.businesses.length>1?(o.businesses.forEach(function(t){t.name===e().name&&(n=t)}),t.currentPlace().yelpResults(n)):t.currentPlace().yelpResults(o.businesses[0]),t.yelpHeadline("Yelp has "+t.currentPlace().yelpResults().review_count+" reviews.")},error:function(e){console.log("yelp error",e),t.yelpRequestSuccess(!1),t.yelpHeadline("There was an error, please try again later.")}};$.ajax(h)}}app.detailsSidebar=document.getElementById("details-sidebar"),app.mapDivEl=document.getElementById("mapDiv"),app.listingEl=document.getElementById("listings"),app.leftHamburger=document.getElementById("leftHamburger"),app.headerEl=document.getElementById("weather"),app.neighborhood={lat:40.7466891,lng:-73.8908579},app.service,app.inspectionsArray=[],app.RestaurantArray=[],app.currentHighlight=null,app.googleErr=function(){console.log("googleErr hit");var e=document.getElementById("listings"),t=document.createElement("h3");t.innerHTML="There is a problem with Google Maps, please check your internet connection",t.style.color="red",e.append(t)},app.initMap=function(){var t=[{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"transit.station",stylers:[{weight:9},{hue:"#e85113"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"on"},{color:"#f0e4d3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]}],o=document.getElementById("mapDiv");app.map=new google.maps.Map(o,{center:app.neighborhood,zoom:15,styles:t,mapTypeId:google.maps.MapTypeId.ROADMAP,navigationControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}}),app.infoWindow=new google.maps.InfoWindow,e()};var r;r=function(e,t){var o=this;this.index=t+1,o.selected=!1,this.mapIconNormal="img/mapMakerIcons/3b8dc8/restaurant.png",this.mapIconRed="img/mapMakerIcons/ff0000/restaurant.png",this.geometry=e.geometry,this.address_formatted="",this.address_components=e.address_components,this.phone=e.formatted_phone_number,this.hours=e.opening_hours,this.photos=e.photos,this.reviews=e.reviews,this.website="",this.id=e.id,this.name=e.name,this.placeId=e.place_id,this.priceLevel=e.price_level,this.rating=e.rating,this.vicinity=e.vicinity,this.mapIcon=this.mapIconNormal,this.mapMarker="",this.inspectionResults=ko.observableArray(),this.addDetails=function(e){this.address_components=e.address_components,this.address_formatted=e.formatted_address,this.phone=e.formatted_phone_number,this.geometry=e.geometry,this.hours=e.opening_hours,this.rating=e.rating,this.photos=e.photos,this.reviews=e.reviews,this.website=e.website},this.yelpResults=ko.observableArray()},ko.bindingHandlers.fadeVisible={init:function(e,t){var o=t();$(e).toggle(ko.unwrap(o))},update:function(e,t){var o=t();ko.unwrap(o)?$(e).fadeIn():$(e).fadeOut()}},ko.bindingHandlers.toggleSlide={init:function(e,t){var o=t();$(e).toggle(ko.unwrap(o))},update:function(e){$(e).toggle("slide")}}}(),function(){for(var e,t=function(){},o=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],n=o.length,a=window.console=window.console||{};n--;)e=o[n],a[e]||(a[e]=t)}(),function(){function e(e){return"rain"===e?a.rain:"snow"===e?a.snow:"sleet"===e?a.sleet:"hail"===e?a.sleet:"wind"===e?a.wind:"fog"===e?a.fog:"cloudy"===e?a.cloudy:"partly-cloudy-day"===e?a.partly_cloudy_day:"partly-cloudy-night"===e?a.partly_cloudy_night:"clear"===e?a.clear_day:"clear-day"===e?a.clear_day:"clear-night"===e?a.clear_night:a.cloudy}var t,o="https://api.darksky.net/forecast/5253877f6a8235bbb4323b0a1a70239a/40.7466891,-73.8908579";$.ajax({url:o,data:{format:"json"},dataType:"jsonp",success:function(o){console.log("ajax request success\n"+o),t=new n(o),e(t.getIcon()),ko.applyBindings(t,document.getElementById("weather"))},error:function(){console.log("ajax request failed.");var e=document.getElementById("weather");e.innerHTML="Sorry no weather data, please check your internet connection."}});var n=function(t){this.summary=ko.observable(t.currently.summary),this.icon=t.currently.icon,this.getIcon=function(){return this.icon},this.rainProb=ko.observable(t.currently.precipProbability),this.temp=ko.computed(function(){return Math.round(t.currently.temperature)}),this.tempFeel=ko.computed(function(){return Math.round(t.currently.apparentTemperature)}),this.dailySummary=ko.observable(t.daily.summary),this.weatherImg=e(this.icon)},a={rain:"img/SVG/Cloud-Rain.svg",snow:"img/SVG/Cloud-Snow.svg",sleet:"img/SVG/Cloud-Hail-Alt.svg",hail:"img/SVG/Cloud-Hail-Alt.svg",wind:"img/SVG/Wind.svg",fog:"img/SVG/Cloud-Fog-Alt.svg",cloudy:"img/SVG/Cloud.svg",partly_cloudy_day:"img/SVG/Cloud-Sun.svg",partly_cloudy_night:"img/SVG/Cloud-Moon.svg",clear_day:"img/SVG/Sun.svg",clear_night:"img/SVG/Moon.svg"}}();